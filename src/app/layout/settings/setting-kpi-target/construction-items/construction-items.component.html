<div class="px-3">
  <div class="menu">
    <h5 class="d-inline mb-0 mr-auto text-dark text-uppercase font-weight-bold">chỉ tiêu kpi hạng mục thi công </h5>
  </div>
  <div class="card p-3">
    <div class="row">
      <div class="col-md-3">
        <span class="font-weight-bold required">Năm:&nbsp;</span>&nbsp;&nbsp;
        <span class="custom-dropdown">
          <select class="form-control select-year--width" [(ngModel)]="yearkpi" (change)="changeYearTargetFuc()">
            <option value="null" *ngIf="paramAction === 'create'">--Lựa chọn--</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>
            <option value="2020">2020</option>
          </select>
        </span>
      </div>
      <div class="col-md-6 d-flex align-items-center">
        <span class="font-weight-bold">Tổng chỉ tiêu:&nbsp;</span>
        <span>{{ constructionCategoryForm?.get('targetTotal').value ?
          (constructionCategoryForm?.get('targetTotal')?.value | truncateDecimal) : '0.00'}}</span>
      </div>
      <div class="text-right col-md-3">
        <ng-container *ngIf="paramAction === 'view'">
          <button class="btn btn-secondary" type="button" [routerLink]="['../construction-items']" [queryParams]="{action:'edit'}">Sửa
          </button>
          <button type="submit" class="btn btn-primary ml-1" [routerLink]="['../construction-items']" [queryParams]="{action:'create'}"
            (click)="createConstructionType()">Thêm
            mới chỉ tiêu
          </button>
        </ng-container>
        <ng-container *ngIf="paramAction === 'edit' || paramAction === 'create'">
          <button class="btn btn-secondary" type="button" [routerLink]="['../construction-items']" [queryParams]="{action:'view'}">Hủy
          </button>
          <button type="submit" class="btn btn-primary ml-1" (click)="createOrEditConstructionCategory()">Lưu
          </button>
        </ng-container>
      </div>
    </div>
    <div class="row pt-2">
      <div class="col-md-12">
        <form [formGroup]="constructionCategoryForm" novalidate class="pt-3" *ngIf="constructionCategoryForm">
          <table class="zui-table table table-striped table-hover mt-1">
            <thead>
              <tr>
                <th class="font-weight-bold">Hạng mục thi công</th>
                <th class="text-right font-weight-bold">Tổng giá trị</th>
                <th class="text-right font-weight-bold">Tỷ lệ cần đạt (%)</th>
                <th class="text-right font-weight-bold">Giá trị cần đạt (VND)</th>
              </tr>
            </thead>
            <tbody>
              <ng-container formArrayName="mainBuild">
                <ng-container>
                  <tr *ngFor="let itemMainBuild of mainBuildFA.controls; let i = index" [formGroupName]="i">
                    <td>{{itemMainBuild?.get('constructionTypeName').value}}</td>
                    <ng-container *ngIf="paramAction === 'view'">
                      <td class="text-right">{{ itemMainBuild?.get('total').value ? (itemMainBuild?.get('total').value
                        | truncateDecimal) : '0.00'}}</td>
                      <td class="text-right">{{ itemMainBuild?.get('percent').value ?
                        (itemMainBuild?.get('percent').value | truncateDecimal) : '0.00'}} %</td>
                      <td class="text-right">{{ itemMainBuild?.get('totalTarget').value ?
                        (itemMainBuild?.get('totalTarget').value | truncateDecimal) : '0.00'}}</td>
                    </ng-container>
                    <ng-container *ngIf="paramAction === 'edit' || paramAction === 'create'">
                      <td class="text-right">
                        <input type="text" appInputThousandSeparate class="w-100 m-0 p-0 text-right" formControlName="total"
                          (input)="calculTargetTotalToChangeTotal(i)">
                      </td>
                      <td class="text-right">
                        <div class="parent-percent">
                          <input type="text" appInputThousandSeparate class="w-100 m-0 p-0 text-right cus-input"
                            formControlName="percent" (input)="calculTargetTotalToChangePercent(i)">
                          <span class="span-percent">%</span>
                        </div>
                      </td>
                      <td class="text-right">{{ itemMainBuild?.get('totalTarget').value ?
                        (itemMainBuild?.get('totalTarget').value | truncateDecimal) : '0.00'}}</td>
                    </ng-container>
                  </tr>
                </ng-container>
              </ng-container>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </div>
</div>