<div [@routerTransition]>
    <div class="search-box d-flex">
        <h5 class="mr-auto d-flex align-items-end">Danh sách cơ hội</h5>
        <div class="input-group">
            <span class="input-group-addon">Tìm kiếm theo</span>
            <input type="text" class="form-control" placeholder="Tên, khách hàng, liên hệ" (keyup)="searchTerm$.next($event.target.value)">
        </div>
        <div class="btn-group ml-2" ngbDropdown>
            <button type="button" class="btn btn-primary" ngbDropdownToggle data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Công cụ &nbsp;
            </button>
            <div class="dropdown-menu" ngbDropdownMenu>
                <a class="dropdown-item" (click)="multiDelete()">Xóa</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" (click)="exportFileExcel()">Xuất file</a>
            </div>
           
        </div>
        <button class="btn btn-primary ml-2" *ngIf="isLeader" [routerLink]="['/opportunity/create']">
            <i class="fa fa-plus" aria-hidden="true" ></i>&nbsp; Thêm cơ hội</button>
        <button class="btn btn-primary ml-2" (click)="refresh(true)">
            <i class="fa fa-refresh" aria-hidden="true"></i>
        </button>
    </div>
    <hr>

    <div class="filter-bar">
        <div class="form-inline">
            <div class="form-group ml-sm-2">
                <label for="prospectSource" class="form-label">Phân loại</label>
                <span class="custom-dropdown mx-sm-2">
                    <select class="form-control" [(ngModel)]="filterModel.classify">
                        <option [ngValue]="null">--Lựa chọn--</option>
                        <option *ngFor="let item of opportunityClassifyList | async" [value]="item.id">{{item.text}}</option>
                    </select>
                </span>
            </div>
            <div class="form-group ml-sm-2">
                <label for="jobTitle" class="form-label">Giai đoạn</label>
                <span class="custom-dropdown mx-sm-2">
                    <select class="form-control" [(ngModel)]="filterModel.step">
                        <option [ngValue]="null">--Lựa chọn--</option>
                        <option *ngFor="let item of opportunityStepList | async" [value]="item.id">{{item.text}}</option>
                    </select>
                </span>
            </div>
            <button type="submit" class="btn btn-primary ml-sm-3" (click)="filter()">
                <i class="fa fa-filter" aria-hidden="true"></i>&nbsp; Lọc
            </button>
            <button class="btn btn-secondary ml-sm-3" (click)="clearFilter()">
                <i class="fa fa-times"></i>&nbsp; Xóa lọc
            </button>
        </div>
    </div>

    <div>
        <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table-selection stripe row-border hover">
            <thead>
                <tr>
                    <th class="text-center">
                        <label class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" [(ngModel)]="checkboxSeclectAll" (change)="onSelectAll($event.target.checked)">
                            <span class="custom-control-indicator"></span>

                        </label>


                    </th>
                    <th>Tên cơ hội</th>
                    <th>Khách hàng</th>
                    <th>Liên hệ</th>
                    <th>Phân loại</th>
                    <!-- <th>Nguồn tiềm năng</th> -->
                    <th class="text-center">Giá trị dự kiến</th>
                    <th>Giai đoạn</th>
                    <th>Xác suất</th>
                    <!-- <th>Chiến lược</th> -->
                    <th>Phân công cho</th>
                    <th class="table-action">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of pagedResult.items">
                    <td class="text-center">
                        <label class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" [(ngModel)]="item.checkboxSelected">
                            <span class="custom-control-indicator"></span>

                        </label>
                    </td>
                    <td>
                        <a [routerLink]="['../detail', item.id]" [title]="item.opportunityName">{{ item.opportunityName }}</a>
                    </td>
                    <td [title]="item.customerName ? item.customerName : ''">{{ item.customerName }}</td>
                    <td>
                        <span *ngIf="item.contact" [title]="item.contact">
                            {{item.contact}}
                        </span>
                    </td>

                    <td>{{ item.category | translate }}</td>
                    <!-- <td>{{ item.source | translate }}</td> -->
                    <td class="text-right">{{ item.expectedValue | vnCurrency }}</td>
                    <td>{{ item.phase | translate}}</td>
                    <td>{{ item.probability && item.probability + '%'}} </td>
                    <!-- <td>{{ item.campaign }}</td> -->
                    <td [title]="item.assignTo">{{ item.assignTo }}</td>
                    <td>
                        <a [routerLink]="['/opportunity/detail', item.id]">
                            <i class="fa fa-eye text-warning" aria-hidden="true"></i>
                        </a>
                        <a [routerLink]="['/opportunity/edit', item.id]" class=" text-success ml-3">
                            <i class="fa fa-pencil  cursor-pointer" aria-hidden="true"> </i>
                        </a>
                        <!-- <a class="text-info ml-3" [href]="'mailto:' + item.email">
                            <i class="fa fa-envelope-o " aria-hidden="true"></i>
                        </a> -->
                        <a (click)="delete(item.id)" class="text-dark ml-3">
                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </a>
                    </td>
                </tr>
            </tbody>


        </table>
    </div>

    <app-pagination [pagedResult]="pagedResult" (pagedResultChange)="pagedResultChange($event)"></app-pagination>
</div>

<ngx-spinner bdColor="rgba(51, 51, 51, 0.7)" size="medium" color="#fff" type="ball-clip-rotate-multiple"></ngx-spinner>
