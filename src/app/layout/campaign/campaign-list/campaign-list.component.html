<div [@routerTransition]>
    <div class="search-box d-flex">
        <h5 class="mr-auto d-flex align-items-end">Danh sách chiến dịch</h5>
        <div class="input-group">
            <span class="input-group-addon">Tìm kiếm theo</span>
            <input type="text" class="form-control" placeholder="Tên, phân công" (keyup)="searchTerm$.next($event.target.value)">
        </div>

        <div class="btn-group ml-2" ngbDropdown>
            <button type="button" class="btn btn-primary" ngbDropdownToggle data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Công cụ &nbsp;
            </button>
            <div class="dropdown-menu" ngbDropdownMenu>
                <a class="dropdown-item" (click)="multiDelete()">Xóa</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" (click)="exportFileExcel()">Xuất file</a>
            </div>
        </div>
        <button class="btn btn-primary ml-2" [routerLink]="['/campaign/create']">
            <i class="fa fa-plus" aria-hidden="true"></i>&nbsp; Thêm chiến dịch</button>
        <button class="btn btn-primary ml-2" (click)="refresh(true)">
            <i class="fa fa-refresh" aria-hidden="true"></i>
        </button>
    </div>
    <hr>

    <div class="filter-bar">
        <div class="form-inline">
            <div class="form-group ml-sm-2">
                <label for="prospectSource" class="form-label">Loại chiến dịch</label>
                <span class="custom-dropdown mx-sm-2">
                    <select class="form-control" [(ngModel)]="filterModel.type">
                        <option [ngValue]="null">--Lựa chọn--</option>
                        <option *ngFor="let item of campaignTypeList | async" [value]="item.id">{{item.text}}</option>
                    </select>
                </span>
            </div>
            <div class="form-group ml-sm-2">
                <label for="jobTitle" class="form-label">Trạng thái chiến dịch</label>
                <span class="custom-dropdown mx-sm-2">
                    <select class="form-control" [(ngModel)]="filterModel.campaignStatus">
                        <option [ngValue]="null">--Lựa chọn--</option>
                        <option *ngFor="let item of campaignStatusList | async" [value]="item.id">{{item.text}}</option>
                    </select>
                </span>
            </div>
            <button type="submit" class="btn btn-primary ml-sm-3" (click)="filter()">
                <i class="fa fa-filter" aria-hidden="true"></i>&nbsp; Lọc
            </button>
            <button  class="btn btn-secondary ml-sm-3" (click)="clearFilter()">
                <i class="fa fa-times" ></i>&nbsp; Xóa lọc
            </button>
        </div>
    </div>

    <div>
        <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table-selection stripe row-border hover">
            <thead>
                <tr>
                    <th class="text-center">
                        <label class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" [(ngModel)]="checkboxSeclectAll" (change)="onSelectAll($event.target.checked)">
                            <span class="custom-control-indicator"></span>

                        </label>


                    </th>
                    <th>Tên chiến dịch</th>
                    <th>Loại chiến dịch</th>
                    <th class="th-mark-status">Trạng thái</th>
                    <th>Ngày bắt đầu</th>
                    <th>Dự kiến xong</th>
                    <th>Mục tiêu chiến dịch</th>
                    <th>Số lượng</th>
                    <th>Phân công cho</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of pagedResult.items">
                    <td class="text-center">
                        <label class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" [(ngModel)]="item.checkboxSelected">
                            <span class="custom-control-indicator"></span>

                        </label>
                    </td>
                    <td>
                        <a [routerLink]="['../detail', item.id]" [title]="item.name" >{{ item.name }}</a>
                    </td>
                    <td [title]="(item.category ? item.category : '') | translate" >{{ item.category | translate}}</td>
                    <td class="td-mark-status">
                        <div class="mark-status" [class.status-plan]='item.status=="IsPlanning_Campaign"' [class.status-inprogess]='item.status=="Proceed_Campaign"'
                            [class.status-complete]='item.status=="Finish_Campaign"' [class.status-cancel]='item.status=="Cancel"'
                            [class.status-pending]='item.status=="DoNotProceed"'>
                            {{ item.status | translate }}
                        </div>
                    </td>
                    <td>{{ item.campaignDateStart | date:'dd/MM/yyyy'}}</td>
                    <td>{{ item.campaignDateStop | date:'dd/MM/yyyy' }}</td>
                    <td [title]="item.target ? item.target : ''">{{ item.target }}</td>
                    <td>{{ item.numberOfParticipants && item.numberOfParticipants + '%'}}</td>
                    <td [title]="item.assignTo" >{{ item.assignTo }}</td>
                    <td>
                        <a [routerLink]="['/campaign/detail', item.id]">
                            <i class="fa fa-eye text-warning" aria-hidden="true"></i>
                        </a>
                        <a [routerLink]="['/campaign/edit', item.id]" class="text-success ml-3">
                            <i class="fa fa-pencil  cursor-pointer" aria-hidden="true"> </i>
                        </a>
                        <a (click)="delete(item.id)" class="text-dark ml-3">
                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </a>
                    </td>
                </tr>
            </tbody>


        </table>
    </div>
    <app-pagination [pagedResult]="pagedResult" (pagedResultChange)="pagedResultChange($event)"></app-pagination>

</div>

<ngx-spinner bdColor="rgba(51, 51, 51, 0.7)" size="medium" color="#fff" type="ball-clip-rotate-multiple"></ngx-spinner>
